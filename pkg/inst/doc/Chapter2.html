<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Richard P. Shefferson, Shun Kurokawa, and Johan Ehrlén" />


<title>Lathyrus vernus raw MPMs</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Lathyrus vernus raw MPMs</h1>
<h4 class="author">Richard P. Shefferson, Shun Kurokawa, and Johan
Ehrlén</h4>



<p style="text-indent: 20px">
In this vignette, we will use the <code>lathyrus</code> dataset to
illustrate the estimation of <strong>empirical</strong> or
<strong>raw</strong> MPMs. We will produce matrices similar to those
published in <span class="citation">Ehrlén (2000)</span>, though there
will be some differences because our dataset includes data for more
individuals as well as an extra year of monitoring. It also includes
differences in classification due to different assumptions regarding
transitions to and from the vegetative dormancy life stage.
</p>
<p style="text-indent: 20px">
To reduce vignette size, we have prevented some statements from running
if they produce long stretches of output. Examples include most
<code>summary()</code> calls. In these cases, we include hashtagged
versions of these calls, and we encourage the user to run these
statements without hashtags.
</p>
<p style="text-indent: 20px">
This vignette is only a sample analysis. Detailed information and
instructions on using <code>lefko3</code> are available through a free
online e-book called <em>lefko3: a gentle introduction</em>, available
on <a href="http://www.sheffersonlab.com/projects.html">the projects
page</a> of the Shefferson lab website.
</p>
<div id="organism-and-population" class="section level3">
<h3>ORGANISM AND POPULATION</h3>
<p style="text-indent: 20px">
<em>Lathyrus vernus</em> (family Fabaceae) is a long-lived forest herb,
native to Europe and large parts of northern Asia. Individuals increase
slowly in size and usually flower only after 10-15 years of vegetative
growth. Flowering individuals have an average conditional lifespan of
44.3 years <span class="citation">(Ehrlén and Lehtila 2002)</span>.
<em>L. vernus</em> lacks organs for vegetative spread and individuals
are well delimited <span class="citation">(Ehrlén 2002)</span>. One or
several erect shoots of up to 40 cm height emerge from a subterranean
rhizome in March and April. Flowering occurs about four weeks after
shoot emergence. Shoot growth is determinate, and the number of flowers
is determined in the previous year <span class="citation">(Ehrlén and
Van Groenendael 2001)</span>. Individuals do not necessarily produce
aboveground structures every year, and instead can remain vegetatively
dormant in one or more seasons. <em>L. vernus</em> is self-compatible
but requires visits from bumble-bees to produce seeds. Individuals
produce few, large seeds and establishment from seeds is relatively
frequent <span class="citation">(Ehrlén and Eriksson 1996)</span>. The
pre-dispersal seed predator <em>Bruchus atomarius</em> often consumes a
large fraction of developing seeds, and roe deer (<em>Capreolus
capreolus</em>) sometimes consume the shoots <span class="citation">(Ehrlén and Munzbergova 2009)</span>.
</p>
<p style="text-indent: 20px">
Data for this study were collected from six permanent plots in a
population of <em>L. vernus</em> located in a deciduous forest in the
Tullgarn area, SE Sweden, from 1988 to 1991 <span class="citation">(Ehrlén 1995)</span>. The plots had similar soil type,
elevation, slope, and canopy cover. Within each plot, all individuals
were marked with numbered tags that remained over the study period, and
their locations were mapped. At the time of shoot emergence, we recorded
whether individuals were alive and produced above-ground shoots, and if
shoots had been grazed. During flowering, we recorded flower number and
the height and diameter of all shoots. At fruit maturation, we counted
the number of intact and damaged seeds. To derive a measure of
aboveground size for each individual, we calculated the volume of each
shoot as <span class="math inline">\(\pi × (\frac{1}{2} diameter)^2 ×
height\)</span>, and summed the volumes of all shoots. This measure is
strongly correlated with the dry mass of aboveground tissues (<span class="math inline">\(R^2 = 0.924\)</span>, <span class="math inline">\(P &lt; 0.001\)</span>, <span class="math inline">\(n = 50\)</span>, log-transformed values; Ehrlén
1995). Size of grazed individuals was estimated based on measures of
shoot diameter in grazed shoots, and the relationship between shoot
diameter and shoot height in non-grazed individuals. Individuals that
lacked aboveground structures in one season but reappeared in the
following year were considered dormant. Individuals that lacked
aboveground structures in two subsequent seasons were considered dead
from the year in which they first lacked aboveground structures.
Probabilities of seeds surviving to the next year, and of being present
as seedlings or seeds in the soil seed bank, were derived from separate
yearly sowing experiments in separate plots adjacent to each subplot
<span class="citation">(Ehrlén and Eriksson 1996)</span>.
</p>
</div>
<div id="basic-workflow" class="section level3">
<h3>BASIC WORKFLOW</h3>
<p style="text-indent: 20px">
Our dataset is organized in horizontal format, with rows corresponding
to unique individuals and columns corresponding to individual condition
in particular observation occasions (which we also refer to as
<em>years</em> here). The original spreadsheet file used to keep the
dataset has a repeating pattern to these columns, with each year having
a similarly arranged group of variables. Let’s take a look at this
dataset.
</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lefko3)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(lathyrus)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(lathyrus)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1119   38</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(lathyrus)</span></span></code></pre></div>
<p style="text-indent: 20px">
This dataset includes information on 1,119 individuals arranged
horizontally, by row. There are 38 variables, by column. The first two
columns are variables giving identifying information about each
individual. This is followed by four sets of nine columns, each named
<code>VolumeXX</code>, <code>lnVolXX</code>, <code>FCODEXX</code>,
<code>FlowXX</code>, <code>IntactseedXX</code>, <code>Dead19XX</code>,
<code>DormantXX</code>, <code>Missing19XX</code>, and
<code>SeedlingXX</code>, where <code>XX</code> corresponds to the year
of observation and with years organized consecutively. Thus, columns
3-11 refer to year 1988, columns 12-20 refer to year 1989, etc. This
strictly repeating pattern allows us to manipulate the original dataset
quickly and efficiently via <code>lefko3</code>. There are four years of
data, from 1988 to 1991. Ideally, we should also have arranged the
columns in the same order for each year, with years in consecutive order
with no extra columns between them. This order is not required, provided
that we input all variable names in correct order when transforming the
dataset later.
</p>
<div id="step-1.-life-history-model-development" class="section level4">
<h4>Step 1. Life history model development</h4>
<p style="text-indent: 20px">
We will now create a <strong>stageframe</strong>, which is a data frame
that describes all stages in the life history of the organism, in a way
usable by the functions in this package and using stage names and
descriptions that completely match those used in the dataset. It links
the dataset to the <em>life cycle graph</em> used to model the
organism’s life history. It should include complete descriptions of all
stages that occur in the dataset, with each stage defined uniquely.
Since this object can be used for automated classification, all sizes,
reproductive states, and other characteristics defining each stage in
the dataset need to be accounted for explicitly. The final description
of each stage occurring in the dataset must not completely overlap with
any other stage also found in the dataset, although partial overlap is
allowed and expected.
</p>
<p style="text-indent: 20px">
Here, we create a stageframe named <code>lathframe</code> based on the
classification used in <span class="citation">Ehrlén (2000)</span>. We
build this by creating vectors of the characteristics describing each
stage, with each element always in the same order within the vector,
using the <code>sf_create()</code> function. The most important settings
have to do with the size bins for the stages. Two methods are currently
allowed: 1) a vector of representative sizes in the option called
<code>sizes</code> along with the associated minimum and maximum sizes
for each stage in the options called <code>sizemin</code> and
<code>sizemax</code>, or 2) a vector of stage size bin midpoints in the
<code>sizes</code> option along with the half-width of each size bin in
the <code>binhalfwidth</code> option. Note that the representative
sizes, whether midpoint or otherwise, are not actually used in any
calculations - the size bin minima and maxima are the most important
data used in calculations. Here, we will use approach 2), focused on the
use of size bin half-widths.
</p>
<p style="text-indent: 20px">
If size values are not to be binned, then narrow half bin-widths can be
used (the default is 0.5, and all entries must be positive). For
example, in this dataset, vegetatively dormant individuals necessarily
have a size of zero, and so we can set the <code>halfbinwidth</code> for
this stage to 0.5 provided that the resulting size bin does not overlap
with any other size bin matching the other characteristics of vegetative
dormancy. We can also set this manually with the <code>sizemin</code>
and <code>sizemax</code> options, if we prefer.
</p>
<p style="text-indent: 20px">
Here we use a single size variable, but up to three size variables may
be used. Vector <code>stagenames</code> must include unique names only.
Vectors <code>repstatus</code>, <code>obsstatus</code>,
<code>matstatus</code>, <code>immstatus</code>, <code>propstatus</code>,
and <code>indataset</code> are binomial vectors referring to status as a
reproductive stage, status as an observed stage, status as a mature
stage, status as an immature stage, status as a propagule stage, and
status as a stage occurring within the user-supplied dataset,
respectively. The combination of these characteristics must be
completely unique for each stage. The final vector, called
<code>comments</code>, holds strings of stage descriptions.
</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sizevector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">13</span>, <span class="dv">127</span>, <span class="dv">3730</span>, <span class="dv">3800</span>, <span class="dv">0</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>stagevector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sd&quot;</span>, <span class="st">&quot;Sdl&quot;</span>, <span class="st">&quot;Tm&quot;</span>, <span class="st">&quot;Sm&quot;</span>, <span class="st">&quot;La&quot;</span>, <span class="st">&quot;Flo&quot;</span>, <span class="st">&quot;Dorm&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>repvector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>obsvector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>matvector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>immvector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>propvector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>indataset <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>binvec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">11</span>, <span class="dv">103</span>, <span class="dv">3500</span>, <span class="dv">3800</span>, <span class="fl">0.5</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>comments <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Dormant seed&quot;</span>, <span class="st">&quot;Seedling&quot;</span>, <span class="st">&quot;Tiny vegetative&quot;</span>, <span class="st">&quot;Small vegetative&quot;</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Large vegetative&quot;</span>, <span class="st">&quot;Flowering&quot;</span>, <span class="st">&quot;Vegetatively dormant&quot;</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>lathframe <span class="ot">&lt;-</span> <span class="fu">sf_create</span>(<span class="at">sizes =</span> sizevector, <span class="at">stagenames =</span> stagevector, </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">repstatus =</span> repvector, <span class="at">obsstatus =</span> obsvector, <span class="at">propstatus =</span> propvector,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">immstatus =</span> immvector, <span class="at">matstatus =</span> matvector, <span class="at">indataset =</span> indataset,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">binhalfwidth =</span> binvec, <span class="at">comments =</span> comments)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#lathframe</span></span></code></pre></div>
<p style="text-indent: 20px">
Care should be taken in assigning sizes to stages, particularly when
stages occur with <code>size = 0</code>. In most cases, a size of zero
will mean that the individual is alive but not observable, such as in
the case of vegetative dormancy. However, a size of zero may have other
meanings. For example, if the size metric used is a logarithm of the
measured size, then observable sizes of zero and lower may be possible.
These situations may impact matrix construction and analysis,
particularly when dealing with function-based MPMs, such as IPMs.
</p>
</div>
<div id="step-2a.-data-standardization" class="section level4">
<h4>Step 2a. Data standardization</h4>
<p style="text-indent: 20px">
Next, we will standardize the dataset into <em>vertical format</em>.
Vertically formatted datasets are structured such that each row
corresponds to the state of a single individual in two (if ahistorical)
or three (if historical) consecutive monitoring occasions. Function
<code>verticalize3()</code> will create a <em>historically formatted
vertical dataset</em>, or <em>hfv dataset</em>. We can use one of two
approaches for this task, both using this function. In the most general
case, we may input all column names from the original dataset in each
input option in the same order, corresponding to monitoring occasion.
This allows any format of dataset to be used. An easier approach may be
used in datasets with strictly repeating sets of columns. In the latter
case, most of the inputs should constitute the names of the first
variables coding for particular states. For example,
<code>Seedling1988</code> is the first variable coding for status as a
juvenile, <code>Volume88</code> is the first variable coding for the
main size metric, and <code>Intactseed88</code> is the first variable
coding for fecundity. Function <code>verticalize3()</code> can determine
the locations of variables for later monitoring occasions assuming a
repeating pattern of such variables organized as blocks for each year
(noted as <code>blocksize</code>, which here equals 9 because there are
nine such variables per year in the same order). There are four
monitoring occasions (noted as <code>noyears</code>). We also have a
repeated censor variable, the first of which is
<code>Missing1988</code>, and we note here that we wish to censor the
data and to keep data points with <code>NA</code> values in the censor
term. The <code>patchidcol</code> and <code>individcol</code> terms are
variables denoting which patch/subpopulation and individual each row of
data belongs to, respectively. The setting <code>NAas0 = TRUE</code>
tells R that missing values in size and fecundity should be interpreted
as zeros, which allows us to infer incidents of vegetative dormancy as
cases where size is equal to zero. Finally, <code>stageassign</code>
ties the dataset to the correct stageframe. Note that prior to
standardizing this dataset, we need to create a new individual identity
variable, <code>indiv_id</code>, composed of the identity of the patch
that the individual is in as well as its patch-specific ID, because
otherwise individual identity will be shared by plants in different
patches.
</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>lathyrus<span class="sc">$</span>indiv_id <span class="ot">&lt;-</span> <span class="fu">paste</span>(lathyrus<span class="sc">$</span>SUBPLOT, lathyrus<span class="sc">$</span>GENET)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>lathvert <span class="ot">&lt;-</span> <span class="fu">verticalize3</span>(lathyrus, <span class="at">noyears =</span> <span class="dv">4</span>, <span class="at">firstyear =</span> <span class="dv">1988</span>, </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">patchidcol =</span> <span class="st">&quot;SUBPLOT&quot;</span>, <span class="at">individcol =</span> <span class="st">&quot;indiv_id&quot;</span>, <span class="at">blocksize =</span> <span class="dv">9</span>, </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">juvcol =</span> <span class="st">&quot;Seedling1988&quot;</span>, <span class="at">sizeacol =</span> <span class="st">&quot;Volume88&quot;</span>, <span class="at">repstracol =</span> <span class="st">&quot;FCODE88&quot;</span>, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">fecacol =</span> <span class="st">&quot;Intactseed88&quot;</span>, <span class="at">deadacol =</span> <span class="st">&quot;Dead1988&quot;</span>, <span class="at">nonobsacol =</span> <span class="st">&quot;Dormant1988&quot;</span>, </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">stageassign =</span> lathframe, <span class="at">stagesize =</span> <span class="st">&quot;sizea&quot;</span>, <span class="at">censorcol =</span> <span class="st">&quot;Missing1988&quot;</span>, </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">censorkeep =</span> <span class="cn">NA</span>, <span class="at">censorRepeat =</span> <span class="cn">TRUE</span>, <span class="at">censor =</span> <span class="cn">TRUE</span>, <span class="at">NAas0 =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary_hfv</span>(lathvert, <span class="at">full =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; This hfv dataset contains 2527 rows, 54 variables, 1 population, </span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 patches, 1053 individuals, and 3 time steps.</span></span></code></pre></div>
<p style="text-indent: 20px">
The resulting reorganization has dramatically changed the dimensions of
the dataset, which started with 1119 rows and 38 variables, and now has
2527 rows and 54 variables. The <code>verticalize3()</code> function
includes error-checking measures designed to find instances where
individual characteristics do not match those assigned to stages in the
associated stageframe. In those instances, warning messages will be
displayed and the instances will be marked <code>NoMatch</code> in
<code>stage1</code>, <code>stage2</code>, or <code>stage3</code>. The
<code>summary_hfv()</code> function allows us to quickly summarize the
main characteristics of our resulting <em>hfv</em> dataset, and we can
see a longer summary by removing <code>full = FALSE</code>.
</p>
<p style="text-indent: 20px">
If we remove <code>full = FALSE</code> from the
<code>summary_hfv()</code> call, then our summary will reveal that the
<code>verticalize3()</code> function has automatically subset the data
to only those instances in which the individual is alive in occasion
<em>t</em> (please look at the variable <code>alive2</code>). Knowing
this can help us interpret other variables. For example, the mean value
for <code>alive3</code> suggests very high survival to occasion
<em>t</em>+1 (92.2%). Further, the minimum values for all size variables
are zero, suggesting that unobservable stages occur within the dataset
(these are instances of vegetative dormancy).
</p>
<p style="text-indent: 20px">
The <code>verticalize3()</code> function has made stage assignments for
all individuals at each time. This can be seen in the subset summary in
the <code>stage2index</code> column, which shows all individuals that
are alive and have a size of 0 in occasion <em>t</em> to be in the
seventh stage. Type <code>lathframe</code> and enter at the prompt to
check that the seventh stage in the stageframe is really vegetative
dormancy.
</p>
<p style="text-indent: 20px">
A data subset summary can teach us how reproduction is handled here. The
reproductive status of flowering adults is set as reproductive in
<code>lathframe</code>, and a subset summary of just those individuals
flowering in occasion <em>t</em> shows all of those individuals set to
reproductive (see the distribution of values for <code>repstatus2</code>
in the output below). However, fecundity ranges from 0 to 66 (see
<code>feca2</code>, which codes for fecundity in occasion <em>t</em>),
meaning that some flowering adults do not actually produce any
offspring. In fact, only 44.2% of flowering plants produced seed in
occasion <em>t</em>. This happened because our reproductive status
variable, <code>FCODE88</code>, notes whether these individuals flowered
but not whether they produced seed. Since this plant must be pollinated
by an insect vector, some flowers should yield no seed. This issue does
not cause problems in the creation of raw matrices, but it might cause
difficulties in the creation of function-based matrices under some
conditions. It helps to consider whether the definitions used for stages
are appropriate, and so whether reproductive status must necessarily be
associated with <em>successful</em> reproduction or merely the attempt.
Here, we associate it with the latter, but in other vignettes we will
reconsider this assumption.
</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lathvert[<span class="fu">which</span>(lathvert<span class="sc">$</span>stage2 <span class="sc">==</span> <span class="st">&quot;Flo&quot;</span>),<span class="fu">c</span>(<span class="dv">22</span><span class="sc">:</span><span class="dv">27</span>)])</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      alive1         stage1           stage1index        sizea2         size2added        repstra2</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Min.   :0.000   Length:599         Min.   :0.000   Min.   :  98.4   Min.   :  98.4   Min.   :1  </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:0.000   Class :character   1st Qu.:0.000   1st Qu.: 732.5   1st Qu.: 732.5   1st Qu.:1  </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Median :1.000   Mode  :character   Median :5.000   Median :1141.8   Median :1141.8   Median :1  </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Mean   :0.576                      Mean   :3.297   Mean   :1388.5   Mean   :1388.5   Mean   :1  </span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:1.000                      3rd Qu.:6.000   3rd Qu.:1758.0   3rd Qu.:1758.0   3rd Qu.:1  </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Max.   :1.000                      Max.   :7.000   Max.   :7032.0   Max.   :7032.0   Max.   :1</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lathvert[<span class="fu">which</span>(lathvert<span class="sc">$</span>stage2 <span class="sc">==</span> <span class="st">&quot;Flo&quot;</span>),<span class="fu">c</span>(<span class="dv">28</span><span class="sc">:</span><span class="dv">33</span>)])</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   repstr2added     feca2          fec2added         censor2    juvgiven2   obsstatus2</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Min.   :1     Min.   : 0.000   Min.   : 0.000   Min.   :0   Min.   :0   Min.   :1   </span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:1     1st Qu.: 0.000   1st Qu.: 0.000   1st Qu.:0   1st Qu.:0   1st Qu.:1   </span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Median :1     Median : 0.000   Median : 0.000   Median :0   Median :0   Median :1   </span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Mean   :1     Mean   : 4.793   Mean   : 4.793   Mean   :0   Mean   :0   Mean   :1   </span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:1     3rd Qu.: 6.000   3rd Qu.: 6.000   3rd Qu.:0   3rd Qu.:0   3rd Qu.:1   </span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Max.   :1     Max.   :66.000   Max.   :66.000   Max.   :0   Max.   :0   Max.   :1</span></span></code></pre></div>
</div>
<div id="step-2b.-provide-supplemental-information-for-matrix-estimation" class="section level4">
<h4>Step 2b. Provide supplemental information for matrix estimation</h4>
<p style="text-indent: 20px">
Now we will create <strong>supplement tables</strong>, which provide
external data for matrix estimation not included in the main demographic
dataset. Specifically, we will provide the seed dormancy probability and
germination rate, which are given as transitions from the dormant seed
stage to another year of seed dormancy or to the germinated seedling
stage, respectively. We assume that the germination rate is the same
regardless of whether the seed was produced in the previous year or has
been in the seedbank for longer. We will incorporate both terms as
constants for specific transitions within our matrices, and as constant
multipliers for fecundity, since fecundity will be estimated as the
product of seed produced and either the seed germination rate or the
seed dormancy/survival rate. The fecundity multipliers will also serve
to tell R which transitions are the fecundity transitions.
</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>lathsupp2 <span class="ot">&lt;-</span> <span class="fu">supplemental</span>(<span class="at">stage3 =</span> <span class="fu">c</span>(<span class="st">&quot;Sd&quot;</span>, <span class="st">&quot;Sdl&quot;</span>, <span class="st">&quot;Sd&quot;</span>, <span class="st">&quot;Sdl&quot;</span>), </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">stage2 =</span> <span class="fu">c</span>(<span class="st">&quot;Sd&quot;</span>, <span class="st">&quot;Sd&quot;</span>, <span class="st">&quot;rep&quot;</span>, <span class="st">&quot;rep&quot;</span>),</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">givenrate =</span> <span class="fu">c</span>(<span class="fl">0.345</span>, <span class="fl">0.054</span>, <span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">multiplier =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">0.345</span>, <span class="fl">0.054</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>), <span class="at">stageframe =</span> lathframe, <span class="at">historical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#lathsupp2</span></span></code></pre></div>
<p style="text-indent: 20px">
The supplement table above will only work with ahistorical MPMs, while
the next supplement table will work for historical MPMs. The primary
difference is the incorporation of stage in time <em>t</em>-1. Going
back a further step to look at time <em>t</em>-1 shows us that there are
two ways that a dormant seed in time <em>t</em> can be a dormant seed in
time <em>t</em>+1 - it could have been a dormant seed in time
<em>t</em>-1, or it could have been produced by a flowering adult in
time <em>t</em>-1. Likewise, a seed in occasion <em>t</em> could have
become a seedling in occasion <em>t</em>+1 after being produced by a
flowering adult in occasion <em>t</em>-1, or remaining in the seed bank
in occasion <em>t</em>-1. So, we will enter four given transitions in
the historical case, rather than two transitions as in the ahistorical
case. We will also designate that transitions from seed in occasion
<em>t</em>-1 and seedling in occasion <em>t</em> to mature stages in
occasion <em>t</em>+1 should originate from the <code>NotAlive</code>
stage in occasion <em>t</em>-1, because the seed stage does not actually
occur in the dataset and so function <code>rlefko3()</code> will not
estimate these transitions without knowing the appropriate proxy set.
</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>lathsupp3 <span class="ot">&lt;-</span> <span class="fu">supplemental</span>(<span class="at">stage3 =</span> <span class="fu">c</span>(<span class="st">&quot;Sd&quot;</span>, <span class="st">&quot;Sd&quot;</span>, <span class="st">&quot;Sdl&quot;</span>, <span class="st">&quot;Sdl&quot;</span>, <span class="st">&quot;Sd&quot;</span>, <span class="st">&quot;Sdl&quot;</span>, <span class="st">&quot;mat&quot;</span>),</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">stage2 =</span> <span class="fu">c</span>(<span class="st">&quot;Sd&quot;</span>, <span class="st">&quot;Sd&quot;</span>, <span class="st">&quot;Sd&quot;</span>, <span class="st">&quot;Sd&quot;</span>, <span class="st">&quot;rep&quot;</span>, <span class="st">&quot;rep&quot;</span>, <span class="st">&quot;Sdl&quot;</span>),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">stage1 =</span> <span class="fu">c</span>(<span class="st">&quot;Sd&quot;</span>, <span class="st">&quot;rep&quot;</span>, <span class="st">&quot;Sd&quot;</span>, <span class="st">&quot;rep&quot;</span>, <span class="st">&quot;npr&quot;</span>, <span class="st">&quot;npr&quot;</span>, <span class="st">&quot;Sd&quot;</span>),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">eststage3 =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;mat&quot;</span>),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">eststage2 =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;Sdl&quot;</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">eststage1 =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="st">&quot;NotAlive&quot;</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">givenrate =</span> <span class="fu">c</span>(<span class="fl">0.345</span>, <span class="fl">0.345</span>, <span class="fl">0.054</span>, <span class="fl">0.054</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">multiplier =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="fl">0.345</span>, <span class="fl">0.054</span>, <span class="cn">NA</span>),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>), <span class="at">type_t12 =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">stageframe =</span> lathframe, <span class="at">historical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">#lathsupp3</span></span></code></pre></div>
<p style="text-indent: 20px">
These two supplement tables show us that we have survival-transition
probabilities (<code>type = 1</code>, whereas fecundity rates would be
given as <code>type = 2</code>) and fecundity multipliers
(<code>type = 3</code>), that the second and fourth transitions involve
reproduction from occasion <em>t</em>-1 to occasion <em>t</em> while the
others involve survival (<code>type_t12 = 1</code> for survival between
occasions <em>t</em>-1 and <em>t</em>, and <code>type_t12 = 2</code> for
fecundity), that the given transitions originate from the dormant seed
stage (<code>Sd</code>) in occasion <em>t</em> (and seeds or
reproductive stages in occasion <em>t</em>-1 in the historical case),
and the specific values to be used in overwriting and to multiply
fecundity values by: <code>0.345</code> and <code>0.054</code>. If we
wished, we could have used the values of transitions to be estimated
within this matrix as proxies for these values, in which case we would
enter the stages corresponding to the correct transitions in the
<code>eststageX</code> columns, and the <code>givenrate</code> column
would be blank. This is precisely what we did for one set of transitions
- namely transitions from the seedling class to mature stages. Finally,
we have also included fecundity multipliers for newly produced seed in
the bottom two rows.
</p>
<p style="text-indent: 20px">
Note that the <code>supplemental()</code> function allowed us to isolate
specific transitions to alter, and to use shorthand to identify large
groups of transitions (e.g. using <code>mat</code>, <code>immat</code>,
<code>rep</code>, <code>nrep</code>, <code>prop</code>,
<code>npr</code>, <code>obs</code>, <code>nobs</code>,
<code>groupX</code>, or <code>all</code> to signify all mature stages,
immature stages, reproductive stages, non-reproductive stages, propagule
stages, non-propagule stages, observable stages, non-observable stages,
stages within group <code>X</code>, or simply all stages, respectively).
Function <code>supplemental()</code> also allowed us to tell R which
transitions to treat as primary reproductive transitions, which was
accomplished by identifying these transitions with reproductive
multipliers.
</p>
</div>
<div id="step-3.-tests-of-history" class="section level4">
<h4>Step 3. Tests of history</h4>
<p style="text-indent: 20px">
We have chosen to build both ahistorical and historical MPMs in this
vignette. However, in a typical analysis, it is most parsimonious to
test whether history influences the demography of the population
significantly first, and only use historical MPMs if the test supports
the hypothesis that it does. A number of methods exist to conduct these
tests, and we recommend <span class="citation">Brownie et al.
(1993)</span>, <span class="citation">Pradel, Wintrebert, and Gimenez
(2003)</span>, <span class="citation">Pradel (2005)</span>, and <span class="citation">Cole et al. (2014)</span> for good discussions and
tools to help with this.
</p>
<p style="text-indent: 20px">
In <code>lefko3</code>, we provide a function that can be used to test
for the effects of history directly from the historical vertical
dataset: <code>modelsearch()</code>. Function <code>modelsearch()</code>
estimates best-fit linear models of the key vital rates used to
propagate elements in function-based MPMs. There are up to 14 different
vital rates possible to test, of which seven are adult vital rates and
seven are juvenile vital rates. The standard vital rates that we may
wish to test are survival (marked as <code>surv</code> in
<code>vitalrates</code>), primary size (<code>size</code>), and
fecundity (<code>fec</code>), which are the default vital rates assumed
by the function. Here, we also test observation status
(<code>obs</code>), which can serve as a proxy for sprouting probability
in cases where plants do not necessarily sprout, and reproductive status
(<code>repst</code>), which assesses the probability of reproduction in
cases where reproduction is not certain. This dataset also includes
juveniles whose vital rates we wish to estimate. We designate this by
setting <code>juvestimate</code> to the correct juvenile stage in the
dataset. Because size varies in juveniles, we also set
<code>juvsize = TRUE</code>.
</p>
<p style="text-indent: 20px">
To test history with function <code>modelsearch</code>: 1) use the
historical vertical dataset as input, 2) set
<code>historical = TRUE</code>, 3) input the relevant vital rates to
estimate, 4) set the suite of independent factors to test (size and
reproductive status in occasions <em>t</em> and <em>t</em>-1 and all
interactions, or some subset thereof), 5) set the name of the juvenile
stage (if juvenile vital rates are to be estimated and such stages occur
in the dataset), 6) set the proper distributions to use for size and
fecundity, and 7) note which variables code for individual identity
(used to treat identity as a random factor in mixed linear models),
patch identity (if multiple patches occur in the dataset and vital rates
should be estimated with patch as a factor), and observation occasion.
We also set <code>quiet = &quot;partial&quot;</code> to limit the amount of text
output while the function runs.
</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>histtest <span class="ot">&lt;-</span> <span class="fu">modelsearch</span>(lathvert, <span class="at">historical =</span> <span class="cn">TRUE</span>, <span class="at">suite =</span> <span class="st">&quot;main&quot;</span>,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">vitalrates =</span> <span class="fu">c</span>(<span class="st">&quot;surv&quot;</span>, <span class="st">&quot;obs&quot;</span>, <span class="st">&quot;size&quot;</span>, <span class="st">&quot;repst&quot;</span>, <span class="st">&quot;fec&quot;</span>), <span class="at">juvestimate =</span> <span class="st">&quot;Sdl&quot;</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sizedist =</span> <span class="st">&quot;gaussian&quot;</span>, <span class="at">fecdist =</span> <span class="st">&quot;gaussian&quot;</span>, <span class="at">indiv =</span> <span class="st">&quot;individ&quot;</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="st">&quot;year2&quot;</span>, <span class="at">juvsize =</span> <span class="cn">TRUE</span>, <span class="at">quiet =</span> <span class="st">&quot;partial&quot;</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Developing global model of survival probability...</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Global model of survival probability developed. Proceeding with model dredge...</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Developing global model of observation probability...</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Global model of observation probability developed. Proceeding with model dredge...</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Developing global model of primary size...</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Global model of primary size developed. Proceeding with model dredge...</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Developing global model of reproduction probability...</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Global model of reproduction probability developed. Proceeding with model dredge...</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Developing global model of fecundity...</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Global model of fecundity developed. Proceeding with model dredge...</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Developing global model of juvenile survival probability...</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Global model of juvenile survival probability developed. Proceeding with model dredge...</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: Juvenile maturity status in time t+1 appears to be constant, and so will be set to constant.</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Developing global model of juvenile observation probability...</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Global model of juvenile observation probability developed. Proceeding with model dredge...</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Developing global model of juvenile primary size...</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Could not properly estimate a global model for juvenile size.</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: Juvenile reproductive status in time t+1 appears to be constant, and so will be set to constant.</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Finished selecting best-fit models.</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(histtest)</span></span></code></pre></div>
<p style="text-indent: 20px">
The summary generated is quite long, and likely resulted in a series of
warnings from the model-building functions utilized. For our purposes,
we need only look at elements corresponding to the best-fit models for
our tested vital rates, which are the elements marked
<code>survival_model</code>, <code>observation_model</code>,
<code>size_model</code>, <code>repstatus_model</code>,
<code>fecundity_model</code>, <code>juv_survival_model</code>,
<code>juv_observation _model</code>, <code>juv_size_model</code>,
<code>juv_reproduction_model</code>, and
<code>juv_maturity_model</code>. The line beginning
<code>Formula:</code> in each of these sections shows the best-fit
model, in standard R formula notation (i.e. <span class="math inline">\(y = ax + b\)</span> is given as
<code>y ~ x</code>). The independent terms tested include variables
coding for size in occasions <em>t</em> and <em>t</em>-1, given as
<code>sizea2</code> and <code>sizea1</code>, and reproductive status in
occasions <em>t</em> and <em>t</em>-1, given as <code>repstatus2</code>
and <code>repstatus1</code>, respectively. Since several vital rates
show <code>sizea1</code> or <code>repstatus1</code> as term in the
best-fit models, most notably for adult survival, primary size,
reproduction probability, and fecundity, we see that individual history
has a significant impact on the demography of this population. The
quality control information in element <code>qc</code> is also of
interest, showing that some of our models are quite strong, with
accuracy of 0.982 for adult survival and 0.903 for observation, while
others are less accurate, most notably primary size and fecundity.
</p>
</div>
<div id="step-4.-mpm-estimation" class="section level4">
<h4>Step 4. MPM estimation</h4>
<p style="text-indent: 20px">
Now let’s create some raw Lefkovitch MPMs based on <span class="citation">Ehrlén (2000)</span>. We have seen that history should
be included in these analyses, which justifies creating only historical
matrices. However, to introduce these functions in greater depth and
detail, we will first create ahistorical MPMs. The functions we will use
to build these MPMs include <code>rlefko2()</code> for raw ahistorical
MPMs, and <code>rlefko3()</code> for raw historical MPMs.
</p>
<p style="text-indent: 20px">
<span class="citation">Ehrlén (2000)</span> shows a mean matrix covering
years 1989 and 1990 as occasion <em>t</em>. We will utilize the entire
dataset instead, covering 1988 to 1991. Note that we will not create
matrices for subpopulations in this case (to include them, add the
options <code>patch = &quot;all&quot;, patchcol = &quot;patchid&quot;</code> to the input
below).
</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ehrlen2 <span class="ot">&lt;-</span> <span class="fu">rlefko2</span>(<span class="at">data =</span> lathvert, <span class="at">stageframe =</span> lathframe, <span class="at">year =</span> <span class="st">&quot;all&quot;</span>, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">stages =</span> <span class="fu">c</span>(<span class="st">&quot;stage3&quot;</span>, <span class="st">&quot;stage2&quot;</span>), <span class="at">supplement =</span> lathsupp2, <span class="at">yearcol =</span> <span class="st">&quot;year2&quot;</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">indivcol =</span> <span class="st">&quot;individ&quot;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#ehrlen2</span></span></code></pre></div>
<p style="text-indent: 20px">
The output from this analysis is a <code>lefkoMat</code> object, which
is list with the following elements:
</p>
<p><strong>A</strong>: a list of full population projection matrices, in
order of population, patch, and year (order given in
<code>labels</code>)</p>
<p><strong>U</strong>: a list of matrices where non-zero entries are
limited to survival-transition elements, in the same order as
<code>A</code></p>
<p><strong>F</strong>: a list of matrices where non-zero entries are
limited to fecundity elements, in the same order as <code>A</code></p>
<p><strong>hstages</strong>: a data frame showing the order of paired
stages (given if matrices are historical; otherwise <code>NA</code>)</p>
<p><strong>agestages</strong>: a data frame showing the order of
age-stage pairs (given if matrices are age-by-stage ahistorical;
otherwise <code>NA</code>)</p>
<p><strong>ahstages</strong>: the stageframe used in analysis, with
stages potentially reordered and edited as they occur in the matrix</p>
<p><strong>labels</strong>: a table showing the order of matrices by
population, patch, and year</p>
<p><strong>matrixqc</strong>: a short vector used in
<code>summary</code> statements to describe the overall quality of each
matrix (used in <code>summary()</code> calls)</p>
<p><strong>dataqc</strong>: a short vector used in <code>summary</code>
statements to describe key sampling aspects of the dataset (used in
<code>summary()</code> calls)</p>
<p style="text-indent: 20px">
Input options for function <code>rlefko2()</code> include
<code>year = &quot;all&quot;</code>, which can be changed to
<code>year = c(1989, 1990)</code> to focus just on years 1989 and 1990,
as in <span class="citation">Ehrlén (2000)</span>, or
<code>year = 1989</code> to focus exclusively on the transition from
1989 to 1990 (the year entered is the year in occasion <em>t</em>).
Matrix-estimating functions in <code>lefko3</code> have a default
behavior of creating matrices for each year in the dataset except the
final year, rather than lumping all years together to produce a single
matrix. However, patches or subpopulations will only be separated if a
patch ID variable is provided as input.
</p>
<p style="text-indent: 20px">
We can understand <code>lefkoMat</code> objects in greater detail
through the <code>summary()</code> function.
</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(ehrlen2)</span></span></code></pre></div>
<p style="text-indent: 20px">
We learn that three full <code>A</code> matrices and their
<code>U</code> and <code>F</code> decompositions were estimated, and
that they are ahistorical. This is expected given that there are four
consecutive years of data, yielding three time steps, and an ahistorical
matrix requires two consecutive years to estimate transitions. The
following line notes the dimensions of those matrices. The third,
fourth, fifth, and sixth lines of the summary show how many survival
transition and fecundity elements were actually estimated, both overall
and per matrix, the number of populations, patches, and time steps
covered by the MPM, and the number of individuals and transitions the
matrices are based on (these last numbers can be used to understand
matrix quality). Finally, the last section shows summaries of the column
sums from the survival-transition (<code>U</code>) matrices in this
<code>lefkoMat</code> object. These column sums correspond to the
survival probabilities of the different life stages, and so the
summaries must show numbers ranging from 0.0 to 1.0.
</p>
<p style="text-indent: 20px">
The matrix creation functions in this package sort the stages provided
in the stageframe according to a standardized rubric, and so the order
of stages in the <code>ahstages</code> element of a
<code>lefkoMat</code> object may differ from the original input.
Particularly, they sort propagules first, followed by immature stages,
followed by non-reproductive adult stages, followed by reproductive
adult stages. Let’s see the order in our matrices. We see that the key
difference from the original input is that the order of the flowering
stage and the vegetative dormancy stage have been flipped.
</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ehrlen2$ahstages</span></span></code></pre></div>
<p style="text-indent: 20px">
Now we’ll estimate historical matrices. Because of the size of these
matrices, we will only show the <code>lefkoMat</code> summary. We will
only create Ehrlén-format matrices - users wishing to create
deVries-format hMPMs should add <code>format = &quot;deVries&quot;</code> to the
input options (the resulting matrices will be bigger, but contain the
same number of estimated elements).
</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ehrlen3 <span class="ot">&lt;-</span> <span class="fu">rlefko3</span>(<span class="at">data =</span> lathvert, <span class="at">stageframe =</span> lathframe, <span class="at">year =</span> <span class="st">&quot;all&quot;</span>, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">stages =</span> <span class="fu">c</span>(<span class="st">&quot;stage3&quot;</span>, <span class="st">&quot;stage2&quot;</span>, <span class="st">&quot;stage1&quot;</span>), <span class="at">supplement =</span> lathsupp3,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">yearcol =</span> <span class="st">&quot;year2&quot;</span>, <span class="at">indivcol =</span> <span class="st">&quot;individ&quot;</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(ehrlen3)</span></span></code></pre></div>
<p style="text-indent: 20px">
The summary output shows several differences from the ahistorical case.
First, there is one less matrix estimated in the historical case than in
the ahistorical case, because raw historical matrices require three
consecutive occasions to estimate each transition instead of two.
Second, these matrices are larger than ahistorical matrices, with the
numbers of rows and columns generally equaling the number of ahistorical
rows and columns squared (although deVries-format increases the
dimensions through the addition of a prior stage for newborns, and in
both Ehrlén and deVries formats the numbers of rows and columns may be
reduced under some circumstances as shown in the next block). Finally, a
much greater proportion of each matrix is composed of zeros in the
historical case than in the ahistorical case, although there are
certainly more non-zero elements as well. This sparseness results from
historical matrices being composed primarily of structural zeros. As a
result, the historical matrices in this example have non-zero entries in
(79 + 7) / 2401 = 3.5% of matrix elements, while the equivalent
ahistorical matrices have non-zero entries in (24.67 + 2) / 49 = 54.4%
of matrix elements.
</p>
<p style="text-indent: 20px">
We can see the impact of structural zeros by eliminating some of them in
the process of matrix estimation. This can be done by setting
<code>reduce = TRUE</code>, which tells <code>rlefko3()</code> to
eliminate stage pairs in which both column and row are zero vectors.
Here, we now have matrices with 19 fewer rows and columns, and (79 + 7)
/ 900 = 9.6% of elements as potentially non-zero.
</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ehrlen3red <span class="ot">&lt;-</span> <span class="fu">rlefko3</span>(<span class="at">data =</span> lathvert, <span class="at">stageframe =</span> lathframe, </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="st">&quot;all&quot;</span>, <span class="at">stages =</span> <span class="fu">c</span>(<span class="st">&quot;stage3&quot;</span>, <span class="st">&quot;stage2&quot;</span>, <span class="st">&quot;stage1&quot;</span>), </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">supplement =</span> lathsupp3, <span class="at">yearcol =</span> <span class="st">&quot;year2&quot;</span>, <span class="at">indivcol =</span> <span class="st">&quot;individ&quot;</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">reduce =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(ehrlen3red)</span></span></code></pre></div>
<p style="text-indent: 20px">
Next we will create the element-wise mean ahistorical matrix. Function
<code>lmean()</code> creates a <code>lefkoMat</code> object retaining
all descriptive information from the original <code>lefkoMat</code>
object. The full output not in any order includes the composite mean
matrix (shown in element <code>A</code>), the mean survival-transition
matrix (<code>U</code>), the mean fecundity matrix (<code>F</code>), a
data frame outlining the definitions and order of historical paired
stages (<code>hstages</code>, shown as <code>NA</code> in this case
because the matrices are ahistorical), a data frame outlining the
age-by-stage combinations used (<code>agestages</code>, shown as
<code>NA</code> because these are not age-by-stage matrices), a data
frame outlining the actual stages as outlined in the
<code>stageframe</code> object used to create these matrices
(<code>ahstages</code>), a data frame outlining the definitions and
order of the matrices (<code>labels</code>), and two quality control
vectors used in output for the <code>summary()</code> function
(<code>matrixqc</code> and <code>dataqc</code>).
</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ehrlen2mean <span class="ot">&lt;-</span> <span class="fu">lmean</span>(ehrlen2)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(ehrlen2mean)</span></span></code></pre></div>
<p style="text-indent: 20px">
Now we will estimate the historical element-wise mean matrix. We will
show only the top-left corner of the rather large matrix (a section
comprised of the first twenty rows and eight columns of the 30 x 30
matrix).
</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ehrlen3mean <span class="ot">&lt;-</span> <span class="fu">lmean</span>(ehrlen3)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#print(ehrlen3mean$A[[1]][1:20,1:8], digits = 3)</span></span></code></pre></div>
<p style="text-indent: 20px">
The prevalence of zeros in this matrix is normal because most elements
are structural zeros and so cannot equal anything else. This matrix is
also a raw matrix, meaning that transitions that do not actually occur
in the dataset cannot equal anything other than zero. Now let’s take a
look at the <code>hstages</code> object associated with this mean
matrix.
</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ehrlen3mean$hstages</span></span></code></pre></div>
<p style="text-indent: 20px">
There are 49 pairs of life history stages, corresponding to the rows and
columns of the historical matrices. The pairs are interpreted so that
matrix columns represent stage pairs in occasions <em>t</em>-1 and
<em>t</em>, and rows represent stage pairs in occasions <em>t</em> and
<em>t</em>+1. For an element in the matrix to contain a number other
than zero, it must represent the same stage at occasion <em>t</em> in
both the column stage pairs and the row stage pairs. For example, The
element [1, 1] represents the transition probability from dormant seed
at occasions <em>t</em>-1 and <em>t</em> (column pair), to dormant seed
at occasions <em>t</em> and <em>t</em>+1 (row pair) - the occasion
<em>t</em> stages match, and so this element is possible. However,
element [1, 2] represents the transition probability from seedling in
occasion <em>t</em>-1 and very small adult in occasion <em>t</em>
(column pair), to dormant seed in occasion <em>t</em> and in occasion
<em>t</em>+1 (row pair). Clearly [1, 2] is a structural zero because it
is impossible for an individual to be both a dormant seed and a very
small adult at the same time.
</p>
<p style="text-indent: 20px">
Error-checking is more difficult with historical matrices because they
are typically one or two orders of magnitude bigger than their
ahistorical counterparts, but the same basic strategy can be used here
as with ahistorical matrices. In these cases we can use
<code>summary()</code> function to assess the key quality control
characteristics of the mean hMPM, such as the distribution of survival
probability estimates for historical stages.
</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(ehrlen3mean)</span></span></code></pre></div>
<p style="text-indent: 20px">
Let’s try another approach, looking at some conditional historical
matrices. Conditional matrices are matrices of ahistorical dimension
that show transitions from stage at occasion <em>t</em> to occasion
<em>t</em>+1, conditional on all individuals having been in the same
stage in occasion <em>t</em>-1. They are calculated from historical
MPMs, and the output below shows all conditional matrices developed from
the first <code>A</code> matrix of <code>ehrlen3mean</code>. The first
matrix, for example, shows all transitions involving individuals that
had been in the dormant seed stage <code>Sd</code> in occasion
<em>t</em>-1, while the last matrix shows transitions involving
individuals that had been vegetatively dormant in occasion <em>t</em>-1.
</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ehrlen3condmn <span class="ot">&lt;-</span> <span class="fu">cond_hmpm</span>(ehrlen3mean)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#ehrlen3condmn$Mcond[[1]]</span></span></code></pre></div>
<p style="text-indent: 20px">
Quick scans will show many transitions missing, because each stage has
only certain stages that can transition from it, and to which it can
transition. Further transitions are missing because the MPM is raw, and
some transitions are not parameterized because no individuals made them.
</p>
<p style="text-indent: 20px">
One last error-checking technique before we analyze our MPMs: matrix
visualization plots. These plots provide a relatively easy way to
understand the “spatial spread” of values throughout a matrix. Package
<code>lefko3</code> includes function <code>image3()</code>, which
provides an easy way to make these images. Let’s start off by looking at
the ahistorical mean matrix.
</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">image3</span>(ehrlen2mean, <span class="at">used =</span> <span class="dv">1</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span></code></pre></div>
<div class="figure">
<img src="figure/Ch2.17-1.png" alt />
<p class="caption">Figure 2.1. Image of mean ahistorical matrix</p>
</div>
<p style="text-indent: 20px">
The resulting image shows non-zero elements as red spaces, and zero
elements as white spaces. Rows and columns are numbered, and we can see
that this matrix is reasonably dense.
</p>
<p style="text-indent: 20px">
Now let’s take a look at the mean historical matrix. The historical mean
matrix has many more rows and columns, and has more of both zero and
non-zero elements. However, it has become a sparse matrix, and it turns
out that increasing the numbers of life stages will increase the
sparsity of historical projection matrices.
</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">image3</span>(ehrlen3mean, <span class="at">used =</span> <span class="dv">1</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span></code></pre></div>
<div class="figure">
<img src="figure/Ch2.18-1.png" alt />
<p class="caption">Figure 2.2. Image of mean historical matrix</p>
</div>
</div>
<div id="step-5.-mpm-analysis" class="section level4">
<h4>Step 5. MPM analysis</h4>
<p style="text-indent: 20px">
Package <code>lefko3</code> includes functions to conduct some analyses
of population dynamics. We will start by estimating the asymptotic
population growth rate (<span class="math inline">\(\lambda\)</span>)
and the stochastic population growth rate (<span class="math inline">\(a
= \text{log} \lambda _{S}\)</span>) from the ahistorical MPMs, including
both the annual MPM and the mean. For the stochastic case, we will set
the seed for R’s random number generation to make our output
reproducible. Note that each <span class="math inline">\(\lambda\)</span> estimate includes a data frame
describing the matrices in order (given as the <code>labels</code>
object within the output list). Here is the set of ahistorical annual
<span class="math inline">\(\lambda\)</span> estimates, followed by
<span class="math inline">\(\lambda\)</span> for the mean matrix, and
the stochastic population growth rate (<span class="math inline">\(a =
\text{log} \lambda _{S}\)</span>).
</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Deterministic ahistorical:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lambda3</span>(ehrlen2)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   pop patch year2    lambda</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   1     1  1988 0.8952585</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2   1     1  1989 0.9235493</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   1     1  1990 1.0096490</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Deterministic mean ahistorical:</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lambda3</span>(ehrlen2mean)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   pop patch    lambda</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   1     1 0.9574162</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Stochastic ahistorical:</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>); <span class="fu">slambda3</span>(ehrlen2)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   pop patch           a        var        sd          se</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   1     1 -0.04490197 0.03154986 0.1776228 0.001776228</span></span></code></pre></div>
<p style="text-indent: 20px">
We will now look at the same numbers for the historical analyses. There
are several differences in the output in addition to the lower growth
rate estimates. First, because there are four years of data, there are
three ahistorical transitions possible for estimation: year 1 to 2, year
2 to 3, and year 3 to 4. However, in the historical case, only two are
possible: from years 1 and 2 to 3 (technically, from years 1
[<em>t</em>-1] and 2 [<em>t</em>] to years 2 [<em>t</em>] and 3
[<em>t</em>+1]), and from years 2 and 3 to 4. Second, historical
matrices cover more of the individual heterogeneity in a population by
splitting ahistorical transitions by stage in occasion <em>t</em>-1.
This heterogeneity may reflect many sources, for example the impacts of
trade-offs operating across years <span class="citation">(Shefferson and
Roach 2010)</span>. One particularly common trade-off is the cost of
growth: an individual that grows a great deal in one time step due to
great environmental conditions in that year might pay a large cost of
survival, growth, or reproduction in the next if those environmental
conditions deteriorate <span class="citation">(Shefferson, Warren II,
and Pulliam 2014; Shefferson et al. 2018)</span>.
</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Deterministic historical:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lambda3</span>(ehrlen3)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   pop patch year2    lambda</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   1     1  1989 0.8863920</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2   1     1  1990 0.9855435</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Deterministic mean historical:</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lambda3</span>(ehrlen3mean)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   pop patch    lambda</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   1     1 0.9182809</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Stochastic historical:</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>); <span class="fu">slambda3</span>(ehrlen3)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   pop patch           a       var        sd          se</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   1     1 -0.08872396 0.0177556 0.1332501 0.001332501</span></span></code></pre></div>
<p style="text-indent: 20px">
We can also examine the stable stage distributions, as follows for the
ahistorical case.
</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ehrlen2mss <span class="ot">&lt;-</span> <span class="fu">stablestage3</span>(ehrlen2mean)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>ehrlen2mss</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   matrix stage_id stage    ss_prop</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      1        1    Sd 0.29261073</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      1        2   Sdl 0.04579994</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      1        3    Tm 0.22875637</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4      1        4    Sm 0.18625613</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5      1        5    La 0.07716891</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6      1        7  Dorm 0.05588715</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7      1        6   Flo 0.11352077</span></span></code></pre></div>
<p style="text-indent: 20px">
The data frame output shows us the stages themselves
(<code>stage</code>, and associated number in <code>stage_id</code>),
which matrix they refer to (<code>matrix</code>), and the stable stage
distribution (<code>ss_prop</code>). Interpreting these values, we find
that the mean matrix suggests that, if we project the population forward
indefinitely assuming the population dynamics are static and represented
by this matrix, we will find that approximately 29% of individuals
should be dormant seeds (suggesting a large seedbank). A further 23% and
19% should be very small and small adults, respectively, and 11% should
be flowering adults. Almost 6% of the population should eventually be
composed of vegetatively dormant adults.
</p>
<p style="text-indent: 20px">
We can estimate the stable stage distribution for the historical case,
as well. Because the historical output for the
<code>stablestage3()</code> function is a list with two data frames,
let’s take a look at each of these data frames in turn. The first will
be the stage-pair output.
</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ehrlen3mss <span class="ot">&lt;-</span> <span class="fu">stablestage3</span>(ehrlen3mean)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#ehrlen3mss$hist</span></span></code></pre></div>
<p style="text-indent: 20px">
This data frame is structured in historical format, and so shows the
stable stage distribution of stage pairs. We may wish to see which stage
pair dominates, in which case we might look at the row with the maximum
<code>ss_prop</code> value.
</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ehrlen3mss<span class="sc">$</span>hist[<span class="fu">which</span>(ehrlen3mss<span class="sc">$</span>hist<span class="sc">$</span>ss_prop <span class="sc">==</span> <span class="fu">max</span>(ehrlen3mss<span class="sc">$</span>hist<span class="sc">$</span>ss_prop)),]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    matrix stage_id_2 stage_id_1 stage_2 stage_1   ss_prop</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 17      1          3          3      Tm      Tm 0.2404459</span></span></code></pre></div>
<p style="text-indent: 20px">
Here we see that about 24% of the population is expected to be composed
of tiny adults maintaining themselves as tiny adults.
</p>
<p style="text-indent: 20px">
The longer format of the historical stable stage output makes it harder
to read. However, historical values can also be combined by stage at
occasion <em>t</em> (<code>stage_2</code>) to estimate the
<strong>historically-corrected stable stage distribution</strong> shown
in the <code>ahist</code> element, which allows comparison to a stable
stage distribution estimated from a purely ahistorical MPM. Notice below
that the <code>ss_prop</code> column shows values that are different
from the purely ahistorical case, suggesting the influence of individual
history.
</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ehrlen3mss<span class="sc">$</span>ahist</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   matrix stage_id stage    ss_prop</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      1        1    Sd 0.26275496</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      1        2   Sdl 0.04112686</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      1        3    Tm 0.29476860</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4      1        4    Sm 0.19794066</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5      1        5    La 0.06553412</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6      1        7  Dorm 0.04645369</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7      1        6   Flo 0.09142110</span></span></code></pre></div>
<p style="text-indent: 20px">
To see the impact of history on the stable stage distribution, let’s
plot the ahistorical and historically-corrected stable stage
distributions together. We will also include the stochastic long-run
stage distribution in our output, which is estimated with the same
function but using the <code>stochastic = TRUE</code> option. This will
allow us to see the impact of random temporal variation.
</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ehrlen2mss_s <span class="ot">&lt;-</span> <span class="fu">stablestage3</span>(ehrlen2, <span class="at">stochastic =</span> <span class="cn">TRUE</span>, <span class="at">seed =</span> <span class="dv">42</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>ehrlen3mss_s <span class="ot">&lt;-</span> <span class="fu">stablestage3</span>(ehrlen3, <span class="at">stochastic =</span> <span class="cn">TRUE</span>, <span class="at">seed =</span> <span class="dv">42</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>ss_put_together <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(ehrlen2mss<span class="sc">$</span>ss_prop, ehrlen3mss<span class="sc">$</span>ahist<span class="sc">$</span>ss_prop,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  ehrlen2mss_s<span class="sc">$</span>ss_prop, ehrlen3mss_s<span class="sc">$</span>ahist<span class="sc">$</span>ss_prop)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ss_put_together) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;d_ahist&quot;</span>, <span class="st">&quot;d_hist&quot;</span>, <span class="st">&quot;s_ahist&quot;</span>, <span class="st">&quot;s_hist&quot;</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ss_put_together) <span class="ot">&lt;-</span> ehrlen2mss<span class="sc">$</span>stage</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">t</span>(ss_put_together), <span class="at">beside=</span>T, <span class="at">ylab =</span> <span class="st">&quot;Proportion&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Stage&quot;</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.35</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;orangered&quot;</span>, <span class="st">&quot;grey&quot;</span>, <span class="st">&quot;darkred&quot;</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;det ahistorical&quot;</span>, <span class="st">&quot;det historical&quot;</span>, <span class="st">&quot;sto ahistorical&quot;</span>, </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sto historical&quot;</span>), <span class="at">pch =</span> <span class="dv">22</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">pt.bg =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;orangered&quot;</span>, <span class="st">&quot;grey&quot;</span>, <span class="st">&quot;darkred&quot;</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="figure/Ch2.25-1.png" alt />
<p class="caption">Figure 2.3. Deterministic and stochastic ahistorical
vs. historically-corrected stable stage distributions</p>
</div>
<p style="text-indent: 20px">
Let’s take the deterministic portion first. Accounting for individual
history increased the prevalence of tiny and small adults, but decreased
the prevalence of dormant seeds, and dormant, large, and flowering
adults. Now when we also take in the impact of temporal stochasticity,
we can see differences in the proportion of dormant seeds, seedlings,
and all adult stages, with the greatest differences in dormant seeds and
tiny adults.
</p>
<p style="text-indent: 20px">
Let’s take a look at the reproductive values now, in similar order to
the stable stage distribution case. Initially, we will create all sets
of reproductive value objects, and then we will plot them. The structure
of these objects is the same as that of the stable stage structure
outputs. Because the four vectors are all standardized such that the
first non-zero reproductive value is set to 1.0, they are on different
scales, and so we will make them comparable for plotting purposes by
standardizing them against their vector sums.
</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ehrlen2mrv <span class="ot">&lt;-</span> <span class="fu">repvalue3</span>(ehrlen2mean)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>ehrlen3mrv <span class="ot">&lt;-</span> <span class="fu">repvalue3</span>(ehrlen3mean)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>ehrlen2mrv_s <span class="ot">&lt;-</span> <span class="fu">repvalue3</span>(ehrlen2, <span class="at">stochastic =</span> <span class="cn">TRUE</span>, <span class="at">seed =</span> <span class="dv">42</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>ehrlen3mrv_s <span class="ot">&lt;-</span> <span class="fu">repvalue3</span>(ehrlen3red, <span class="at">stochastic =</span> <span class="cn">TRUE</span>, <span class="at">seed =</span> <span class="dv">42</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>rv_put_together <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>((ehrlen2mrv<span class="sc">$</span>rep_value <span class="sc">/</span> <span class="fu">sum</span>(ehrlen2mrv<span class="sc">$</span>rep_value)),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  (ehrlen3mrv<span class="sc">$</span>ahist<span class="sc">$</span>rep_value <span class="sc">/</span> <span class="fu">sum</span>(ehrlen3mrv<span class="sc">$</span>ahist<span class="sc">$</span>rep_value)),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  (ehrlen2mrv_s<span class="sc">$</span>rep_value <span class="sc">/</span> <span class="fu">sum</span>(ehrlen2mrv_s<span class="sc">$</span>rep_value)), </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  (ehrlen3mrv_s<span class="sc">$</span>ahist<span class="sc">$</span>rep_value <span class="sc">/</span> <span class="fu">sum</span>(ehrlen3mrv_s<span class="sc">$</span>ahist<span class="sc">$</span>rep_value)))</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rv_put_together) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;det ahist&quot;</span>, <span class="st">&quot;det hist&quot;</span>, <span class="st">&quot;sto ahist&quot;</span>, <span class="st">&quot;sto hist&quot;</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(rv_put_together) <span class="ot">&lt;-</span> ehrlen2mrv<span class="sc">$</span>stage</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">t</span>(rv_put_together), <span class="at">beside=</span>T, <span class="at">ylab =</span> <span class="st">&quot;Relative reproductive value&quot;</span>,</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.4</span>), <span class="at">xlab =</span> <span class="st">&quot;Stage&quot;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;orangered&quot;</span>, <span class="st">&quot;grey&quot;</span>, <span class="st">&quot;darkred&quot;</span>),</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;det ahistorical&quot;</span>, <span class="st">&quot;det historical&quot;</span>, <span class="st">&quot;sto ahistorical&quot;</span>, </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sto historical&quot;</span>), <span class="at">pch =</span> <span class="dv">22</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">pt.bg =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;orangered&quot;</span>, <span class="st">&quot;grey&quot;</span>, <span class="st">&quot;darkred&quot;</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="figure/Ch2.26-1.png" alt />
<p class="caption">Figure 2.4. Ahistorical vs. historically-corrected
reproductive values</p>
</div>
<p style="text-indent: 20px">
Both deterministic and stochastic analyses show that flowering adults
have the greatest reproductive value in both ahistorical and historical
analysis, while dormant seeds have the least. However, the historical
MPMs suggest lower contributions of seedlings and vegetative dormancy,
but larger contributions of flowering adults.
</p>
<p style="text-indent: 20px">
Now we will look at the deterministic sensitivities of <span class="math inline">\(\lambda\)</span> to the ahistorical mean matrix
elements.
</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>ehrlen2sens <span class="ot">&lt;-</span> <span class="fu">sensitivity3</span>(ehrlen2mean)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ehrlen2sens<span class="sc">$</span>ah_sensmats[[<span class="dv">1</span>]], <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        [,1]    [,2]   [,3]   [,4]    [,5]    [,6]    [,7]</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,] 0.0182 0.00284 0.0142 0.0116 0.00479 0.00347 0.00705</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] 0.2061 0.03225 0.1611 0.1312 0.05434 0.03936 0.07994</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 0.2565 0.04016 0.2006 0.1633 0.06766 0.04900 0.09953</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 0.4110 0.06432 0.3213 0.2616 0.10838 0.07849 0.15943</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] 0.5639 0.08826 0.4408 0.3589 0.14871 0.10770 0.21877</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [6,] 0.3067 0.04801 0.2398 0.1952 0.08089 0.05858 0.11899</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [7,] 0.7221 0.11302 0.5645 0.4596 0.19043 0.13791 0.28014</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co"># The highest sensitivity value is:</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(ehrlen2sens<span class="sc">$</span>ah_sensmats[[<span class="dv">1</span>]])</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.7220817</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co"># This occurs in element:</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(ehrlen2sens<span class="sc">$</span>ah_sensmats[[<span class="dv">1</span>]] <span class="sc">==</span> <span class="fu">max</span>(ehrlen2sens<span class="sc">$</span>ah_sensmats[[<span class="dv">1</span>]]))</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 7</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co"># The highest sensitivity value among biologically plausible elements is:</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(ehrlen2sens<span class="sc">$</span>ah_sensmats[[<span class="dv">1</span>]][<span class="fu">which</span>(ehrlen2mean<span class="sc">$</span>A[[<span class="dv">1</span>]] <span class="sc">&gt;</span> <span class="dv">0</span>)])</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.4596282</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co"># This occurs in element: </span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(ehrlen2sens<span class="sc">$</span>ah_sensmats[[<span class="dv">1</span>]] <span class="sc">==</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">max</span>(ehrlen2sens<span class="sc">$</span>ah_sensmats[[<span class="dv">1</span>]][<span class="fu">which</span>(ehrlen2mean<span class="sc">$</span>A[[<span class="dv">1</span>]] <span class="sc">&gt;</span> <span class="dv">0</span>)]))</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 28</span></span></code></pre></div>
<p style="text-indent: 20px">
The highest sensitivity value is associated with a biologically
impossible transition - dormant seeds (stage/column 1) cannot transition
to flowering (stage/row 7) (element 7). Among biologically plausible
elements, the highest sensitivity is associated with element 28, which
is the transition from small adult (stage/column 4) to flowering
(stage/row 7).
</p>
<p style="text-indent: 20px">
We will now look at the sensitivity of <span class="math inline">\(\lambda\)</span> to elements in the historical
mean MPM.
</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>ehrlen3sens <span class="ot">&lt;-</span> <span class="fu">sensitivity3</span>(ehrlen3mean)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">#ehrlen3sens</span></span></code></pre></div>
<p style="text-indent: 20px">
The first element produced in this analysis is <code>h_sensmats</code>,
which is a list composed of sensitivity matrices of the historical
matrices, in order (we have only one in our mean matrix object). These
matrices are the same dimensions as the historical matrices used as
input, and so can be quite huge. This is followed by
<code>ah_sensmats</code>, which is a list composed of
historically-corrected sensitivity matrices of corresponding ahistorical
matrix elements (calculated using the historically-corrected stable
stage distribution and reproductive value vector produced in
<code>ehrlen3mss</code> and <code>ehrlen3mrv</code>, respectively). So,
these are different than the sensitivities estimated from the
ahistorical matrices themselves, but have the same dimensions. Next,
<code>h_stages</code> and <code>ah_stages</code> give the order of
paired stages and life history stages used in the historical and
historically-corrected sensitivity matrices, respectively. Finally, we
have the original <code>A</code>, <code>U</code>, and <code>F</code>
matrices used as input.
</p>
<p style="text-indent: 20px">
Our historical matrices are large and full of zeros. So, we will look
for the highest sensitivity associated with a biologically plausible
element (i.e. non-zero matrix elements). Then, we will assess the
highest biologically plausible sensitivity in the historically-corrected
sensitivity matrices, to compare against the ahistorical sensitivity
analysis.
</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The highest sensitivity value among biologically plausible elements:</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(ehrlen3sens<span class="sc">$</span>h_sensmats[[<span class="dv">1</span>]][<span class="fu">which</span>(ehrlen3mean<span class="sc">$</span>A[[<span class="dv">1</span>]] <span class="sc">&gt;</span> <span class="dv">0</span>)])</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.3148525</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This value is associated with element:</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(ehrlen3sens<span class="sc">$</span>h_sensmats[[<span class="dv">1</span>]] <span class="sc">==</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">max</span>(ehrlen3sens<span class="sc">$</span>h_sensmats[[<span class="dv">1</span>]][<span class="fu">which</span>(ehrlen3mean<span class="sc">$</span>A[[<span class="dv">1</span>]] <span class="sc">&gt;</span> <span class="dv">0</span>)]))</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 802</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Highest historically-corrected sensitivity value among plausible elements is:</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(ehrlen3sens<span class="sc">$</span>ah_sensmats[[<span class="dv">1</span>]][<span class="fu">which</span>(ehrlen2mean<span class="sc">$</span>A[[<span class="dv">1</span>]] <span class="sc">&gt;</span> <span class="dv">0</span>)])</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.8591236</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co"># This occurs in element:</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(ehrlen3sens<span class="sc">$</span>ah_sensmats[[<span class="dv">1</span>]] <span class="sc">==</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">max</span>(ehrlen3sens<span class="sc">$</span>ah_sensmats[[<span class="dv">1</span>]][<span class="fu">which</span>(ehrlen2mean<span class="sc">$</span>A[[<span class="dv">1</span>]] <span class="sc">&gt;</span> <span class="dv">0</span>)]))</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 20</span></span></code></pre></div>
<p style="text-indent: 20px">
The maximum biologically plausible sensitivity value in the historical
matrix is element 802, which is associated with column 17 (tiny adult in
occasions <em>t</em>-1 and <em>t</em>) and row 18 (tiny adult in
occasion <em>t</em> to small adult in occasion <em>t</em>+1). This
transition is from tiny adult in occasions <em>t</em>-1 and <em>t</em>
to small adult in <em>t</em>+1. The historically-corrected sensitivity
analysis finds that <span class="math inline">\(\lambda\)</span> is most
sensitive to element 20, which is the transition from tiny adult to
dormant. This is a little different from the ahistorical MPM, which
suggested element 28 (small adult to flowering adult).
</p>
<p style="text-indent: 20px">
We can perform the same analyses as above with stochastic sensitivities.
In that circumstance, simply run the <code>sensitivity3()</code>
function with the <code>stochastic = TRUE</code> argument set, as below.
</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>ehrlen2sens_s <span class="ot">&lt;-</span> <span class="fu">sensitivity3</span>(ehrlen2, <span class="at">stochastic =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>ehrlen3sens_s <span class="ot">&lt;-</span> <span class="fu">sensitivity3</span>(ehrlen3, <span class="at">stochastic =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p style="text-indent: 20px">
A complementary approach to sensitivity analysis is elasticity analysis.
Elasticities are easier to interpret because projection matrix elements
valued at 0 produce elasticity values also equal to 0, thus eliminating
biologically impossible transitions from consideration. Elasticity
values are also scaled to sum to 1.0, making elasticities of survival
transitions easier to compare to those of fecundity. However, they are
also interpreted differently, because while sensitivity analysis shows
the impact of a tiny but <em>absolute</em> change to a matrix element on
<span class="math inline">\(\lambda\)</span>, elasticity analysis shows
the impact of a tiny but <em>proportional</em> change to a matrix
element on <span class="math inline">\(\lambda\)</span>. In fact, both
sensitivities and elasticities are essentially local slopes, and so are
not unit free. It is therefore not unusual for sensitivity and
elasticity analysis to yield different inferences.
</p>
<p style="text-indent: 20px">
Let’s look at the elasticity of <span class="math inline">\(\lambda\)</span> to matrix elements in the
ahistorical mean matrix.
</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>ehrlen2elas <span class="ot">&lt;-</span> <span class="fu">elasticity3</span>(ehrlen2mean)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ehrlen2elas<span class="sc">$</span>ah_elasmats, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         [,1]    [,2]     [,3]   [,4]    [,5]    [,6]   [,7]</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,] 0.00655 0.00000 0.000000 0.0000 0.00000 0.00000 0.0116</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] 0.01162 0.00000 0.000000 0.0000 0.00000 0.00000 0.0206</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 0.00000 0.02784 0.151678 0.0164 0.00052 0.00415 0.0000</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 0.00000 0.00127 0.041102 0.1586 0.02210 0.02184 0.0167</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] 0.00000 0.00000 0.000604 0.0290 0.04851 0.01744 0.0532</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [6,] 0.00000 0.00315 0.007180 0.0223 0.00896 0.00628 0.0107</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [7,] 0.00000 0.00000 0.000000 0.0353 0.06862 0.00887 0.1673</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="co"># The maximum elasticity value:</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(ehrlen2elas<span class="sc">$</span>ah_elasmats[[<span class="dv">1</span>]])</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.167339</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co"># This value is associated with element:</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(ehrlen2elas<span class="sc">$</span>ah_elasmats[[<span class="dv">1</span>]] <span class="sc">==</span> <span class="fu">max</span>(ehrlen2elas<span class="sc">$</span>ah_elasmats[[<span class="dv">1</span>]]))</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 49</span></span></code></pre></div>
<p style="text-indent: 20px">
Elasticity analysis exhibits strong differences from sensitivity
analysis. In particular, we find that <span class="math inline">\(\lambda\)</span> is most strongly elastic in
response to changes in element 49, which is the stasis transition for
flowering adults (stage 7). We can sum the columns of the elasticity
matrix to see which stages <span class="math inline">\(\lambda\)</span>
is most and least elastic in response to, as below.
</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">colSums</span>(ehrlen2elas<span class="sc">$</span>ah_elasmats[[<span class="dv">1</span>]]), <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.0182 0.0323 0.2006 0.2616 0.1487 0.0586 0.2801</span></span></code></pre></div>
<p style="text-indent: 20px">
Here we see that <span class="math inline">\(\lambda\)</span> is most
strongly elastic in response to changes in transitions associated with
flowering adults, followed by transitions involving small adults.
Dormant seeds and seedlings have the smallest impact on <span class="math inline">\(\lambda\)</span>, and the impacts of fecundity
(shown in the top-right corner of the elasticity matrix) appear quite
small.
</p>
<p style="text-indent: 20px">
Now on to elasticity analysis of the historical MPMs. Once again, we
will not output the matrices. Type <code>ehrlen3elas</code> at the
prompt to see these matrices.
</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ehrlen3elas <span class="ot">&lt;-</span> <span class="fu">elasticity3</span>(ehrlen3mean)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The highest deterministic elasticity value:</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(ehrlen3elas<span class="sc">$</span>h_elasmats[[<span class="dv">1</span>]])</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.1718096</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># This value is associated with element:</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(ehrlen3elas<span class="sc">$</span>h_elasmats[[<span class="dv">1</span>]] <span class="sc">==</span> <span class="fu">max</span>(ehrlen3elas<span class="sc">$</span>h_elasmats[[<span class="dv">1</span>]]))</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 801</span></span></code></pre></div>
<p style="text-indent: 20px">
The highest elasticity appears to be associated with the element 801,
which is at row 17, column 17. This corresponds to the stasis transition
of tiny adults (tiny in <em>t</em>-1 to tiny in <em>t</em> to tiny in
<em>t</em>+1).
</p>
<p style="text-indent: 20px">
Elasticities are often treated as additive, making the calculation of
historically-corrected elasticity matrices easy. These are stored in the
<code>ah_elasmats</code> element of <code>elasticity3()</code> output
originating from a historical MPM. Eyeballing this matrix, it appears
that the historically-corrected elasticity matrix supports stasis in the
tiny adult stage as the transition that <span class="math inline">\(\lambda\)</span> is most elastic to, with stasis
in vegetative dormancy a close second.
</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ehrlen3elas<span class="sc">$</span>ah_elasmats, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         [,1]     [,2]    [,3]   [,4]     [,5]    [,6]    [,7]</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1,] 0.00699 0.000000 0.00000 0.0000 0.00e+00 0.01161 0.00000</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [2,] 0.01161 0.000000 0.00000 0.0000 0.00e+00 0.00000 0.00000</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3,] 0.00000 0.010736 0.19877 0.0344 8.26e-05 0.00000 0.00219</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4,] 0.00000 0.000292 0.04500 0.1615 2.56e-02 0.02781 0.01907</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5,] 0.00000 0.000000 0.00000 0.0306 4.54e-02 0.05418 0.00920</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [6,] 0.00000 0.000000 0.00000 0.0366 6.09e-02 0.16395 0.00497</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [7,] 0.00000 0.000583 0.00238 0.0162 7.42e-03 0.00889 0.00315</span></span></code></pre></div>
<p style="text-indent: 20px">
Next, we will create a barplot of the elasticities of life history
stages from ahistorical vs. historically-corrected analyses. We will
also incorporate stochastic elasticity analysis here to assess the
importance of temporal environmental stochasticity on population growth.
</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ehrlen2elas_s <span class="ot">&lt;-</span> <span class="fu">elasticity3</span>(ehrlen2, <span class="at">stochastic =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ehrlen3elas_s <span class="ot">&lt;-</span> <span class="fu">elasticity3</span>(ehrlen3, <span class="at">stochastic =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>elas_put_together <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(<span class="fu">colSums</span>(ehrlen2elas<span class="sc">$</span>ah_elasmats[[<span class="dv">1</span>]]), </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colSums</span>(ehrlen3elas<span class="sc">$</span>ah_elasmats[[<span class="dv">1</span>]]), <span class="fu">colSums</span>(ehrlen2elas_s<span class="sc">$</span>ah_elasmats[[<span class="dv">1</span>]]),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colSums</span>(ehrlen3elas_s<span class="sc">$</span>ah_elasmats[[<span class="dv">1</span>]]))</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(elas_put_together) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;det ahist&quot;</span>, <span class="st">&quot;det hist&quot;</span>, <span class="st">&quot;sto ahist&quot;</span>, <span class="st">&quot;sto hist&quot;</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(elas_put_together) <span class="ot">&lt;-</span> ehrlen2elas<span class="sc">$</span>ahstages<span class="sc">$</span>stage</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">t</span>(elas_put_together), <span class="at">beside=</span>T, <span class="at">ylab =</span> <span class="st">&quot;Elasticity&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Stage&quot;</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;orangered&quot;</span>, <span class="st">&quot;grey&quot;</span>, <span class="st">&quot;darkred&quot;</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;det ahistorical&quot;</span>, <span class="st">&quot;det historical&quot;</span>, <span class="st">&quot;sto ahistorical&quot;</span>, </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sto historical&quot;</span>), <span class="at">pch =</span> <span class="dv">22</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">pt.bg =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;orangered&quot;</span>, <span class="st">&quot;grey&quot;</span>, <span class="st">&quot;darkred&quot;</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="figure/Ch2.35-1.png" alt />
<p class="caption">Figure 2.5. Ahistorical vs. historically-corrected
deterministic and stochastic elasticity to stages</p>
</div>
<p style="text-indent: 20px">
Historical analyses generally find that population growth rate is less
elastic in response to seedlings, and flowering adults, and more elastic
to tiny and dormant adults than in ahistorical analyses. Stochastic and
deterministic population growth rates are barely elastic in response to
dormant seeds and seedlings. Note the dramatic impact of environmental
stochasticity and individual history combined on the impact of tiny
adults.
</p>
<p style="text-indent: 20px">
Let’s now look at the elasticities of different kinds of transitions. We
will use the <code>summary()</code> function, which outputs data frames
summarizing elasticity sums by the kind of transition. First, we will
compare ahistorical against historically-corrected transitions.
</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>ehrlen2elas_sums <span class="ot">&lt;-</span> <span class="fu">summary</span>(ehrlen2elas)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>ehrlen3elas_sums <span class="ot">&lt;-</span> <span class="fu">summary</span>(ehrlen3elas)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>ehrlen2elas_s_sums <span class="ot">&lt;-</span> <span class="fu">summary</span>(ehrlen2elas_s)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>ehrlen3elas_s_sums <span class="ot">&lt;-</span> <span class="fu">summary</span>(ehrlen3elas_s)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>elas_sums_together <span class="ot">&lt;-</span> <span class="fu">cbind.data.frame</span>(ehrlen2elas_sums<span class="sc">$</span>ahist[,<span class="dv">2</span>],</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  ehrlen3elas_sums<span class="sc">$</span>ahist[,<span class="dv">2</span>], ehrlen2elas_s_sums<span class="sc">$</span>ahist[,<span class="dv">2</span>],</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  ehrlen3elas_s_sums<span class="sc">$</span>ahist[,<span class="dv">2</span>])</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(elas_sums_together) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;det ahist&quot;</span>, <span class="st">&quot;det hist&quot;</span>, <span class="st">&quot;sto ahist&quot;</span>, <span class="st">&quot;sto hist&quot;</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(elas_sums_together) <span class="ot">&lt;-</span> ehrlen2elas_sums<span class="sc">$</span>ahist<span class="sc">$</span>category</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">t</span>(elas_sums_together), <span class="at">beside=</span>T, <span class="at">ylab =</span> <span class="st">&quot;Elasticity&quot;</span>,</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Transition&quot;</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;orangered&quot;</span>, <span class="st">&quot;grey&quot;</span>, <span class="st">&quot;darkred&quot;</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;det ahistorical&quot;</span>, <span class="st">&quot;det historical&quot;</span>, <span class="st">&quot;sto ahistorical&quot;</span>, </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;sto historical&quot;</span>), <span class="at">pch =</span> <span class="dv">22</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">pt.bg =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;orangered&quot;</span>, <span class="st">&quot;grey&quot;</span>, <span class="st">&quot;darkred&quot;</span>), <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="figure/Ch2.36-1.png" alt />
<p class="caption">Figure 2.6. Ahistorical vs. historically-corrected
deterministic and stochastic elasticity to transitions</p>
</div>
<p style="text-indent: 20px">
We see similar patterns across types of elasticity analysis.
Particularly, population growth rate is most elastic in response to
changes in stasis transitions, and least elastic to changes in
fecundity. Environmental stochasticity appears to exacerbate these
differences.
</p>
<p style="text-indent: 20px">
<p>Package <code>lefko3</code> also includes functions to conduct many
other analyses, including deterministic and stochastic life table
response experiments, and general projection including quasi-extinction
analysis and density dependent analysis. Users wishing to conduct these
analyses should see our free e-manual called <strong><em>lefko3: a
gentle introduction</em></strong> and other vignettes, including
long-format and video vignettes, on
<a href="http://www.sheffersonlab.com/projects.html">the projects
page</a> of the Shefferson lab website.</p>
</div>
</div>
<div id="acknowledgements" class="section level2">
<h2>Acknowledgements</h2>
<p style="text-indent: 20px">
We are grateful to two anonymous reviewers whose scrutiny improved the
quality of this vignette. The project resulting in this package and this
tutorial was funded by Grant-In-Aid 19H03298 from the Japan Society for
the Promotion of Science.
</p>
</div>
<div id="literature-cited" class="section level2">
<h2>Literature cited</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-brownie_capture-recapture_1993" class="csl-entry">
Brownie, C., James E. Hines, James D. Nichols, Kenneth H. Pollock, and
Jay B. Hestbeck. 1993. <span>“Capture-Recapture Studies for Multiple
Strata Including Non-<span>Markovian</span> Transitions.”</span>
<em>Biometrics</em> 49 (4): 1173–87. <a href="https://doi.org/10.2307/2532259">https://doi.org/10.2307/2532259</a>.
</div>
<div id="ref-cole_does_2014" class="csl-entry">
Cole, Diana J., Byron J. T. Morgan, Rachel S. McCrea, Roger Pradel,
Olivier Gimenez, and Remi Choquet. 2014. <span>“Does Your Species Have
Memory? <span>Analyzing</span> Capture-Recapture Data with Memory
Models.”</span> <em>Ecology and Evolution</em> 4 (11): 2124–33. <a href="https://doi.org/10.1002/ece3.1037">https://doi.org/10.1002/ece3.1037</a>.
</div>
<div id="ref-ehrlen_demography_1995" class="csl-entry">
Ehrlén, Johan. 1995. <span>“Demography of the Perennial Herb
<em><span>Lathyrus</span> Vernus</em>. <span>I</span>.
<span>Herbivory</span> and Individual Performance.”</span> <em>Journal
of Ecology</em> 83 (2): 287–95. <a href="https://doi.org/10.2307/2261567">https://doi.org/10.2307/2261567</a>.
</div>
<div id="ref-ehrlen_dynamics_2000" class="csl-entry">
———. 2000. <span>“The Dynamics of Plant Populations: Does the History of
Individuals Matter?”</span> <em>Ecology</em> 81 (6): 1675–84. <a href="https://doi.org/10.1890/0012-9658(2000)081[1675:TDOPPD]2.0.CO;2">https://doi.org/10.1890/0012-9658(2000)081[1675:TDOPPD]2.0.CO;2</a>.
</div>
<div id="ref-ehrlen_assessing_2002" class="csl-entry">
———. 2002. <span>“Assessing the Lifetime Consequences of Plant-Animal
Interactions for the Perennial Herb <span>Lathyrus</span> Vernus
(<span>Fabaceae</span>).”</span> <em>Perspectives in Plant Ecology,
Evolution and Systematics</em> 5 (3): 145–63. <a href="https://doi.org/10.1078/1433-8319-00031">https://doi.org/10.1078/1433-8319-00031</a>.
</div>
<div id="ref-ehrlen_seedling_1996" class="csl-entry">
Ehrlén, Johan, and Ove Eriksson. 1996. <span>“Seedling Recruitment in
the Perennial Herb <span>Lathyrus</span> Vernus.”</span> <em>Flora</em>
191 (4): 377–83. <a href="https://doi.org/10.1016/S0367-2530(17)30744-2">https://doi.org/10.1016/S0367-2530(17)30744-2</a>.
</div>
<div id="ref-ehrlen_how_2002" class="csl-entry">
Ehrlén, Johan, and Kari Lehtila. 2002. <span>“How Perennal Are Perennial
Plants?”</span> <em>Oikos</em> 98: 308–22. <a href="https://doi.org/10.1034/j.1600-0706.2002.980212.x">https://doi.org/10.1034/j.1600-0706.2002.980212.x</a>.
</div>
<div id="ref-ehrlen_timing_2009" class="csl-entry">
Ehrlén, Johan, and Zuzana Munzbergova. 2009. <span>“Timing of Flowering:
Opposed Selection on Different Fitness Components and Trait
Covariation.”</span> <em>The American Naturalist</em> 173 (6): 819–30.
<a href="https://doi.org/10.1086/598492">https://doi.org/10.1086/598492</a>.
</div>
<div id="ref-ehrlen_storage_2001" class="csl-entry">
Ehrlén, Johan, and Jan Van Groenendael. 2001. <span>“Storage and the
Delayed Costs of Reproduction in the Understorey Perennial
<em><span>Lathyrus</span> Vernus</em>.”</span> <em>Journal of
Ecology</em> 89 (2): 237–46. <a href="https://doi.org/10.1046/j.1365-2745.2001.00546.x">https://doi.org/10.1046/j.1365-2745.2001.00546.x</a>.
</div>
<div id="ref-pradel_multievent_2005" class="csl-entry">
Pradel, Roger. 2005. <span>“Multievent: An Extension of Multistate
Capture-Recapture Models to Uncertain States.”</span>
<em>Biometrics</em> 61: 442–47.
</div>
<div id="ref-pradel_proposal_2003" class="csl-entry">
Pradel, Roger, C. Wintrebert, and O. Gimenez. 2003. <span>“A Proposal
for a Goodness-of-Fit Test to the
<span>Arnason</span>-<span>Schwarz</span> Multisite Capture-Recapture
Model.”</span> <em>Biometrics</em> 59: 43–53. <a href="https://doi.org/10.1111/1541-0420.00006">https://doi.org/10.1111/1541-0420.00006</a>.
</div>
<div id="ref-shefferson_drivers_2018" class="csl-entry">
Shefferson, Richard P., Tiiu Kull, Michael J. Hutchings, Marc-André
Selosse, Hans Jacquemyn, Kimberly M. Kellett, Eric S. Menges, et al.
2018. <span>“Drivers of Vegetative Dormancy Across Herbaceous Perennial
Plant Species.”</span> <em>Ecology Letters</em> 21 (5): 724–33. <a href="https://doi.org/10.1111/ele.12940">https://doi.org/10.1111/ele.12940</a>.
</div>
<div id="ref-shefferson_longitudinal_2010" class="csl-entry">
Shefferson, Richard P., and Deborah A. Roach. 2010. <span>“Longitudinal
Analysis of <em>Plantago</em>: Adaptive Benefits of Iteroparity in a
Short-Lived, Herbaceous Perennial.”</span> <em>Ecology</em> 91 (2):
441–47. <a href="https://doi.org/10.1890/09-0423.1">https://doi.org/10.1890/09-0423.1</a>.
</div>
<div id="ref-shefferson_life_2014" class="csl-entry">
Shefferson, Richard P., Robert J. Warren II, and H. Ronald Pulliam.
2014. <span>“Life History Costs Make Perfect Sprouting Maladaptive in
Two Herbaceous Perennials.”</span> <em>Journal of Ecology</em> 102 (5):
1318–28. <a href="https://doi.org/10.1111/1365-2745.12281">https://doi.org/10.1111/1365-2745.12281</a>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
